<div class="row">
<h1><%= (PayDocumentGroup.order(:code).last.code.to_i + 1).to_s.rjust(7,'0') %></h1>
	<div class="col-md-4">
		<%= form_tag(check_date_path, method: 'post', role: 'form') do %>
			<div class="form-group">
				<%= label_tag :init_date, 'Fecha de inicio' %>
				<%= date_field_tag :init_date,{}, class: 'form-control' %>
			</div>
			<div class="form-group">
				<%= label_tag :end_date, 'Fecha fin' %>
				<%= date_field_tag :end_date,{}, class: 'form-control' %>
			</div>
			<div class="form-group">
				<%= label_tag :insurance, 'Fecha fin' %>
				<%= select_tag :insurance, options_for_select(@insurances), class: 'form-control' %>
			</div>
			<p>
				<%= submit_tag 'Generar Tramas',  data: {confirm: '¿Está seguro que desea generar la trama?'} %>
			</p>
		<% end %>
	</div>
</div>
	<% unless @pay_documents.nil? %>
		<ul>
			<% @pay_documents.each do |p| %>
				<li>
					<%= link_to p.code, ready_principal_facturation_path(pay_document_id: p.id) %>
				</li>
			<% end %>
		</ul>
		
	<% end %>
	<% if @pay_document_groups.exists? %>
			<table class="table">
				<thead>
					<tr>
						<td>Número de lote</td>
						<td>Cantidad de Facturas</td>
						<td>Repetidas?</td>
						<td>Eliminar</td>
						<td>Facturas asociadas</td>
						<td>Exportar con Nº de Lote</td>
						<td>Exportar sin Nº de Lote</td>
					</tr>
				</thead>
				<tbody>
				
					<% @pay_document_groups.each do |l| %>
					<% flag = false %>
					<% arr = Array.new %>
					<% repetido = '' %>
					<% l.pay_documents.each do |p| %>				
						<% arr.each do |a| %>
							<% if arr.include?(p.code) %>
								<% flag = true %>
								<% repetido = p.code %>
							<% end %>
						<% end %>
						<% arr.push(p.code) %>
					<% end %>					
					<tr>
						<td>Lote número <%= l.code %> </td>
						<td><%= l.quantity %></td>
						
						
						<% if flag %>
							<td>SI</td>
						<% else %>
							<td>NO</td>
						<% end %>
						<td><%= repetido %></td>
						<td>
							<%= form_tag(delete_lot_path, method: 'delete') do %>
								<%= hidden_field_tag :lot_code, l.code %>
								<%= submit_tag 'Eliminar trama',  data: {confirm: '¿Desea imprimirla nuevamete?, una trama se genera en el momento que se busca la fecha.'} %>
							<% end %>
						</td>
						<td>
							<div class="dropdown">
								<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
								    Ver Facturas
								    <span class="caret"></span>
								</button>
								<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
							  		<% l.pay_documents.each do |p| %>
										<li role="presentation"><%= link_to 'Factura '+ p.code, ready_principal_facturation_path(pay_document_id: p.id), role: 'menuitem', tabindex: '-1' %></li>
									<% end %>
							  	</ul>
							</div>
						</td>
						<td>
							<%= form_tag(export_lot_path, method: 'post') do %>
								<%= hidden_field_tag :pay_document_group_id, l.id %>
								<%= submit_tag 'Exportar con lote',  data: {confirm: '¿Desea exportar la trama?'} %>
							<% end %>
						</td>
						<td>
							<%= form_tag(export_lot_path, method: 'post') do %>
								<%= hidden_field_tag :pay_document_group_id, l.id %>
								<%= hidden_field_tag :flag, '1' %>
								<%= submit_tag 'Exportar sin lote',  data: {confirm: '¿Desea exportar la trama?'} %>
							<% end %>
						</td>
					</tr>
					<% end %>
				</tbody>
			</table>	
	<% end %>